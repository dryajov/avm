/*
 * THIS  SOFTWARE   CONTAINS  CONFIDENTIAL  INFORMATION
 * AND TRADE SECRETS OF N.L. VERMA / DATUMSOFT SYSTEMS.
 * USE, DISCLOSURE, COPY OR  REPRODUCTION IS PROHIBITED
 * WITHOUT  THE  PRIOR  EXPRESS  WRITTEN  PERMISSION OF
 * NL VERMA / DATUMSOFT SYSTEMS.
 */

#include "prototypes.h"

struct file *dz_file_open(const char *path, INT flags, INT rights) 
{
	struct file *filp = NULL;
	mm_segment_t oldfs;
	INT err = 0;

	oldfs = get_fs();
	set_fs(get_ds());
	filp = filp_open(path, flags, rights);
	set_fs(oldfs);
	if (IS_ERR(filp)) {
		err = PTR_ERR(filp);
		RETURNN;
	}
	return filp;
}
EXPORT_SYMBOL(dz_file_open);

RVOID dz_file_close(struct file *file) 
{
	filp_close(file, NULL);
}
EXPORT_SYMBOL(dz_file_close);

RINT dz_file_read(struct file *file, ULONGLONG offset, UCHAR *data, UINT size) 
{
	mm_segment_t oldfs;
	INT ret;

	oldfs = get_fs();
	set_fs(get_ds());

	ret = vfs_read(file, data, size, &offset);

	set_fs(oldfs);
	return ret;
}
EXPORT_SYMBOL(dz_file_read);

RINT dz_file_write(struct file *file, ULONGLONG offset, UCHAR *data, UINT size) 
{
    mm_segment_t oldfs;
    INT ret;

    oldfs = get_fs();
    set_fs(get_ds());

    ret = vfs_write(file, data, size, &offset);

    set_fs(oldfs);
    return ret;
}
EXPORT_SYMBOL(dz_file_write);

RINT dz_file_sync(struct file *file) 
{
    vfs_fsync(file, 0);
    RETURNS;
}
EXPORT_SYMBOL(dz_file_sync);
